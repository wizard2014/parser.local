<h1 class="text-center form-header">{{ translate('Sign In') }}</h1>

{% set form = loginForm %}
{% do form.prepare() %}

{% do form.setAttributes({
    'action': url('zfcuser/login'),
    'class' : 'form'
}) %}

{{ form().openTag(form)|raw }}

{# check email confirmation #}
{% if formElementErrors(form.get('identity')) %}
    {% set identity = form.get('identity').getMessages()[0] %}
    {% set hasInfo  = '|' in identity %}
    {% set email    = identity|split('|')|first %}
{% endif %}
{# end check #}

{% if formElementErrors(form.get('identity')) or formElementErrors(form.get('credential')) %}
    <div class="alert alert-dismissable{{ hasInfo ? ' alert-info' : ' alert-danger' }}">
        <button type="button" class="close" data-dismiss="alert">Ã—</button>
        <strong>{{ hasInfo ? '' : 'Error!' }}</strong>

        {% if hasInfo %}
            <h4>Confirm your email (<strong>{{ email }}</strong>).</h4>
            <p>After you created your account we sent you a confirmation email. You need to check that out before you can sign in.</p>
            <p>If you didn't receive the email we can send you another one. <a class="btn btn-primary" href="{{ url('resend') }}">Resend</a></p>
        {% else %}
            {{ formElementErrors()
            .setMessageOpenFormat('<p>')
            .setMessageCloseString('</p>')
            .render(form.get('identity'))|raw }}
        {% endif %}
    </div>
{% endif %}

<div class="form-group{% if formElementErrors(form.get('identity')) and not hasInfo %} has-error{% endif %}">
    <span class="sr-only">{{ formLabel(form.get('identity')) }}</span>
    {{ formInput(form.get('identity').setAttributes({
        'class'      : 'form-control',
        'id'         : 'identity',
        'type'       : 'email',
        'autofocus'  : true,
        'required'   : true,
        'placeholder': 'Email',
    })) }}
</div>

<div class="form-group{% if formElementErrors(form.get('credential')) %} has-error{% endif %}">
    <span class="sr-only">{{ formLabel(form.get('credential')) }}</span>
    {{ formInput(form.get('credential').setAttributes({
        'class'      : 'form-control',
        'id'         : 'credential',
        'required'   : true,
        'placeholder': 'Password',
    })) }}
</div>

{% if redirect %}
    <input type="hidden" name="redirect" value="{{ redirect|e }}">
{% endif %}

{{ formButton(form.get('submit').setAttribute('class', 'btn btn-primary btn-lg btn-block submit-btn')) }}

{{ form().closeTag(form)|raw }}

<div class="clearfix">
    <p class="pull-right"><a href="{{ url('zfcuser/forgotpassword') }}">Forgot your password?</a></p>

    {% if enableRegistration %}
        <p class="pull-left">{{ translate('Not registered?') }} <a href="{{ url('zfcuser/register') }}{{ redirect ? '?redirect=' . redirect|e : '' }}">{{ translate('Sign up!') }}</a></p>
    {% endif %}
</div>